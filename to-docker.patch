From 71caf154cdf75d7b3ae78b4f70dc455cf3bd75e4 Mon Sep 17 00:00:00 2001
From: JR Rivers <jrrivers@cumulusnetworks.com>
Date: Tue, 12 Sep 2017 19:36:29 +0000
Subject: [PATCH 1/2] Connect marathon to mesos

---
 roles/mesos-master/templates/marathon.master.j2 | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/roles/mesos-master/templates/marathon.master.j2 b/roles/mesos-master/templates/marathon.master.j2
index 3861f36..069f901 100644
--- a/roles/mesos-master/templates/marathon.master.j2
+++ b/roles/mesos-master/templates/marathon.master.j2
@@ -1 +1 @@
-zk://{{ myvars.V4 }}:2181/marathon
+zk://{{ myvars.V4 }}:2181/mesos
-- 
2.1.4


From c3a79721cc6aa6824d06969f3fac147cb44b5bf7 Mon Sep 17 00:00:00 2001
From: JR Rivers <jrrivers@cumulusnetworks.com>
Date: Tue, 12 Sep 2017 20:20:23 +0000
Subject: [PATCH 2/2] added support for docker containers

---
 roles/mesos-master/tasks/main.yaml                        |  7 +++++++
 .../templates/marathon.task_launch_timeout.j2             |  1 +
 roles/mesos-slave/tasks/main.yaml                         | 15 +++++++++++++++
 roles/mesos-slave/templates/containerizers.j2             |  1 +
 .../templates/executor_registration_timeout.j2            |  1 +
 5 files changed, 25 insertions(+)
 create mode 100644 roles/mesos-master/templates/marathon.task_launch_timeout.j2
 create mode 100644 roles/mesos-slave/templates/containerizers.j2
 create mode 100644 roles/mesos-slave/templates/executor_registration_timeout.j2

diff --git a/roles/mesos-master/tasks/main.yaml b/roles/mesos-master/tasks/main.yaml
index 7fbbb20..17d87ee 100644
--- a/roles/mesos-master/tasks/main.yaml
+++ b/roles/mesos-master/tasks/main.yaml
@@ -86,6 +86,13 @@
     group: root
     mode: 
   become: true
+- template:
+    src: marathon.task_launch_timeout.j2
+    dest: /etc/marathon/conf/task_launch_timeout
+    owner: root
+    group: root
+    mode: 
+  become: true
 
 - name: Restart services
   service:
diff --git a/roles/mesos-master/templates/marathon.task_launch_timeout.j2 b/roles/mesos-master/templates/marathon.task_launch_timeout.j2
new file mode 100644
index 0000000..26f3b3d
--- /dev/null
+++ b/roles/mesos-master/templates/marathon.task_launch_timeout.j2
@@ -0,0 +1 @@
+600000
diff --git a/roles/mesos-slave/tasks/main.yaml b/roles/mesos-slave/tasks/main.yaml
index 11c5ac8..65fafad 100644
--- a/roles/mesos-slave/tasks/main.yaml
+++ b/roles/mesos-slave/tasks/main.yaml
@@ -12,6 +12,7 @@
   with_items:
   - zookeeper
   - mesos
+  - docker
   
 - name: stop services
   service:
@@ -51,6 +52,20 @@
     group: root
     mode: 
   become: true
+- template:
+    src: containerizers.j2
+    dest: /etc/mesos-slave/containerizers
+    owner: root
+    group: root
+    mode: 
+  become: true
+- template:
+    src: executor_registration_timeout.j2
+    dest: /etc/mesos-slave/executor_registration_timeout
+    owner: root
+    group: root
+    mode: 
+  become: true
 
 - name: start services
   service:
diff --git a/roles/mesos-slave/templates/containerizers.j2 b/roles/mesos-slave/templates/containerizers.j2
new file mode 100644
index 0000000..bdb9670
--- /dev/null
+++ b/roles/mesos-slave/templates/containerizers.j2
@@ -0,0 +1 @@
+docker
diff --git a/roles/mesos-slave/templates/executor_registration_timeout.j2 b/roles/mesos-slave/templates/executor_registration_timeout.j2
new file mode 100644
index 0000000..2b267fd
--- /dev/null
+++ b/roles/mesos-slave/templates/executor_registration_timeout.j2
@@ -0,0 +1 @@
+10mins
-- 
2.1.4

